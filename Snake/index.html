<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Our Food Journey</title>

  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #d4fc79, #96e6a1);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    .app {
      background: #ffffff;
      border-radius: 20px;
      padding: 16px;
      width: 360px;
      max-width: 95vw;
      box-shadow: 0 20px 40px rgba(0,0,0,0.25);
      position: relative;
    }

    h1 {
      text-align: center;
      margin: 6px 0 10px;
      color: #2f9e44;
    }

    #speechBubble {
      background: #ffffff;
      border-radius: 16px;
      padding: 10px 14px;
      font-size: 14px;
      color: #333;
      margin-bottom: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      text-align: center;
      min-height: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #speechBubble img {
      max-width: 100%;
      max-height: 200px;
      border-radius: 12px;
    }

    canvas {
      background: #e9fbe7;
      border-radius: 12px;
      display: block;
      margin: 0 auto;
      touch-action: none;
    }

    .hint {
      text-align: center;
      font-size: 12px;
      color: #666;
      margin-top: 8px;
    }


    #endScreen {
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,0.95);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      border-radius: 20px;
      padding: 20px;
      text-align: center;
    }

    #endScreen img {
      max-width: 80%;
      border-radius: 16px;
      margin-bottom: 16px;
    }

    #endScreen h2 {
      color: #2f9e44;
      margin-bottom: 8px;
    }

    #endScreen p {
      color: #333;
      font-size: 15px;
    }
  </style>
</head>

<body>
  <div class="app">
    <h1>Our Food Journey</h1>

    <div id="speechBubble">
    
    </div>

    <canvas id="game" width="320" height="320"></canvas>
    <div class="hint">Swipe or use arrow keys to move</div>

    <!-- ENDING SCREEN -->
    <div id="endScreen">
      <img src="images/ending.png" alt="Ending">
      <h2>Still Hungry for More ðŸ’š</h2>
      <p>Every meal tasted better with you.</p>
    </div>
  </div>

  <!-- MUSIC -->
  <audio id="bgMusic" src="audio/bg-music.mp3" loop></audio>

  <script>
    /*************************
     * ðŸŽ FOOD MEMORIES
     *************************/
    const memories = [
      { img: "images/snake/one.png",   text: "Food memories" },
      { img: "images/snake/two.png",   text: "Food memories" },
      { img: "images/snake/three.png", text: "Food memories" },
      { img: "images/snake/four.png",  text: "Food memories" },
      { img: "images/snake/five.png",  text: "Food memories" },
      { img: "images/snake/six.png",   text: "Food memories" },
      { img: "images/snake/seven.png", text: "Food memories" },
      { img: "images/snake/eight.png", text: "Food memories" },
      { img: "images/snake/nine.png",  text: "Food memories" },
      { img: "images/snake/ten.png",   text: "Food memories" }
    ];

    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const speechBubble = document.getElementById("speechBubble");
    const endScreen = document.getElementById("endScreen");
    const music = document.getElementById("bgMusic");

    const size = 20;
    const cells = canvas.width / size;

    let snake, direction, food, foodIndex, loop;
    let musicStarted = false;
    const foodImage = new Image();
    foodImage.src = "images/pani_puri.png";
    foodImage.onload = () => {
      if (food) draw();
    };

    function startGame() {
      snake = [
        { x: 8, y: 8 },
        { x: 7, y: 8 },
        { x: 6, y: 8 }
      ];
      direction = { x: 1, y: 0 };
      foodIndex = 0;
      speechBubble.textContent = memories[0].text;
      endScreen.style.display = "none";
      spawnFood();
      clearInterval(loop);
      loop = setInterval(update, 220);
    }

    function spawnFood() {
      let pos;
      do {
        pos = {
          x: Math.floor(Math.random() * cells),
          y: Math.floor(Math.random() * cells)
        };
      } while (snake.some(s => s.x === pos.x && s.y === pos.y));
      food = pos;
    }

    function update() {
      const head = {
        x: snake[0].x + direction.x,
        y: snake[0].y + direction.y
      };

      if (
        head.x < 0 || head.y < 0 ||
        head.x >= cells || head.y >= cells ||
        snake.some(s => s.x === head.x && s.y === head.y)
      ) {
        startGame();
        return;
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        foodIndex++;
        if (foodIndex >= memories.length) {
          clearInterval(loop);
          showImage(11);
          setTimeout(() => {
            endScreen.style.display = "flex";
          }, 2000);
          return;
        }
        showImage(foodIndex + 1);
        spawnFood();
      } else {
        snake.pop();
      }

      draw();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw food image
      if (foodImage.complete) {
        ctx.drawImage(foodImage, food.x * size, food.y * size, size, size);
      } else {
        ctx.fillStyle = "#000000";
        ctx.fillRect(food.x * size, food.y * size, size, size);
      }

      // Draw snake
      ctx.fillStyle = "#2f9e44";
      snake.forEach(s =>
        ctx.fillRect(s.x * size, s.y * size, size, size)
      );
    }

    function showImage(imageNumber) {
      clearInterval(loop);
      speechBubble.innerHTML = `<img src="images/${imageNumber}.jpeg" alt="Memory ${imageNumber}">`;
      
      setTimeout(() => {
        if (foodIndex < memories.length) {
          speechBubble.textContent = memories[foodIndex].text;
        }
        loop = setInterval(update, 220);
      }, 2000);
    }

    /*************************
     * KEYBOARD CONTROLS
     *************************/
    document.addEventListener("keydown", e => {
      if (!musicStarted) {
        music.play().catch(() => {});
        musicStarted = true;
      }

      if (e.key === "ArrowLeft" && direction.x !== 1) {
        direction = { x: -1, y: 0 };
      } else if (e.key === "ArrowRight" && direction.x !== -1) {
        direction = { x: 1, y: 0 };
      } else if (e.key === "ArrowUp" && direction.y !== 1) {
        direction = { x: 0, y: -1 };
      } else if (e.key === "ArrowDown" && direction.y !== -1) {
        direction = { x: 0, y: 1 };
      }
    });

    /*************************
     * TOUCH + MUSIC START
     *************************/
    let startX, startY;

    canvas.addEventListener("touchstart", e => {
      if (!musicStarted) {
        music.play().catch(() => {});
        musicStarted = true;
      }
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    });

    canvas.addEventListener("touchend", e => {
      const dx = e.changedTouches[0].clientX - startX;
      const dy = e.changedTouches[0].clientY - startY;

      if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 0 && direction.x !== -1) direction = { x: 1, y: 0 };
        if (dx < 0 && direction.x !== 1)  direction = { x: -1, y: 0 };
      } else {
        if (dy > 0 && direction.y !== -1) direction = { x: 0, y: 1 };
        if (dy < 0 && direction.y !== 1)  direction = { x: 0, y: -1 };
      }
    });

    startGame();
  </script>
</body>
</html>
